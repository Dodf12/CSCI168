<!DOCTYPE html>
<html>
  <body>
    <button id="startButton">Start Animation</button> <!-- Single button for animation -->
    <button id="restart">Reset</button>
    <script src="https://cdn.jsdelivr.net/npm/three/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three/examples/js/controls/OrbitControls.js"></script>
    <script>
      // Global Variables
      let scene, camera, renderer, sphere, bounceSound, animationStarted = false;

      function init() {
        // Renderer
        renderer = new THREE.WebGLRenderer();
        renderer.setSize(800, 600);
        renderer.shadowMap.enabled = true;
        document.body.appendChild(renderer.domElement);

        // Scene
        scene = new THREE.Scene();

        // Add a floor
        function addFloor(scene) {
          const geometry = new THREE.BoxGeometry(200, 10, 200);
          const textureLoader = new THREE.TextureLoader();
          const floorTexture = textureLoader.load(
            'https://dl.polyhaven.org/file/ph-assets/Textures/jpg/4k/precast_stone_paving/precast_stone_paving_diff_4k.jpg'
          );
          floorTexture.wrapS = THREE.RepeatWrapping;
          floorTexture.wrapT = THREE.RepeatWrapping;
          floorTexture.repeat.set(4, 4);

          const material = new THREE.MeshStandardMaterial({
            map: floorTexture,
          });

          const floor = new THREE.Mesh(geometry, material);
          floor.position.set(0, -10, 0);
          scene.add(floor);
        }
        addFloor(scene);

        // Add a basketball
        function addSphere(scene) {
          const g = new THREE.SphereGeometry(5, 32, 32);
          const textureLoader = new THREE.TextureLoader();
          const basketballTexture = textureLoader.load(
            'https://images-ext-1.discordapp.net/external/x4NGWr1hj3IOxnbVk3kiuFeJaeIYRGxZ-FUy3DfL9gQ/https/static.turbosquid.com/Preview/2014/08/01__18_43_57/Basketball%2Btexture%2BBIG.jpgc6d13a7d-85d2-48e2-98d7-eadad3cf75daLarge.jpg?format=webp&width=900&height=450'
          );
          basketballTexture.wrapS = THREE.RepeatWrapping;
          basketballTexture.wrapT = THREE.RepeatWrapping;

          const m = new THREE.MeshStandardMaterial({
            color: 0xdf7237,
            map: basketballTexture,
            metalness: 0.9,
            roughness: 0.7,
          });

          const basketball = new THREE.Mesh(g, m);
          basketball.position.set(0, 5, 0);
          basketball.name = 'basketball';
          basketball.castShadow = true;
          scene.add(basketball);
        }
        addSphere(scene);

        sphere = scene.getObjectByName('basketball');

        // Add lighting
        const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
        directionalLight.position.set(-10, 10, -10);
        directionalLight.castShadow = true;
        scene.add(directionalLight);

        const pointLight = new THREE.PointLight(0xffffff, 2);
        pointLight.position.set(0, 0, 15);
        pointLight.castShadow = true;
        scene.add(pointLight);

        const directionalLight2 = new THREE.DirectionalLight(0xffffff, 1);
        directionalLight2.position.set(90, 30, 100);
        directionalLight2.castShadow = true;
        scene.add(directionalLight2);

        // Camera
        camera = new THREE.PerspectiveCamera(30, 800 / 600, 0.1, 1000);
        camera.position.set(90, 30, 100);
        camera.lookAt(scene.position);

        // Orbit Controls
        const controls = new THREE.OrbitControls(camera, renderer.domElement);

        // Physics
        let acceleration = 9.8;
        let currentVelocity = 0;
        let currentHeight = 5; // Initial height of the sphere
        let currentXDistance = 0; // Initial x position of the sphere
        let currentXVelocity = 3;
        let currentXAcceleration = 2;

        function animate() {
          if (!animationStarted) return; // Exit if animation is not started

          requestAnimationFrame(animate);

          // Time management
          const deltaTime = 0.016; //Approximate framerate

          // Vertical motion
          currentVelocity -= acceleration * deltaTime;
          currentHeight =
            currentHeight +
            currentVelocity * deltaTime +
            0.5 * acceleration * deltaTime * deltaTime;

          // Collision detection with the floor
          if (currentHeight <= 0) {
            currentHeight = 0;
            currentVelocity = -currentVelocity * 0.85;2
          }

          // Horizontal motion
          currentXVelocity += currentXAcceleration * deltaTime;
          currentXDistance +=
            currentXVelocity * deltaTime +
            0.5 * currentXAcceleration * deltaTime * deltaTime;

          if (currentXDistance > 80) {
            currentXVelocity = 0;
          }

          // Update sphere position
          sphere.position.y = currentHeight;
          sphere.position.x = currentXDistance;

          // Render the scene
          renderer.setClearColor(0x7da7eb);
          renderer.render(scene, camera);
        }

        // Audio setup
        const listener = new THREE.AudioListener();
        camera.add(listener);



        // Add event listener to the button to start animation
        document.getElementById('startButton').addEventListener('click', () => {
          if (!animationStarted) {
            animationStarted = true; // Start the animation
            animate(); // Start the animation loop
          }
        });

        document.getElementById('restart').addEventListener('click', () => {
          location.reload(); // Reload the page to reset everything
        });
      }

      window.onload = init;
    </script>
    <h3>Click reset to reload the page and click "Start Animation" to replay animation</h3>
  </body>
</html>